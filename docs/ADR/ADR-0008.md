
ADR-0008 is the architecture’s **temporal decision point**.
This is where we define the rules governing:

- **concurrency**   
- **collapse arbitration**
- **scheduler behavior**
- **race-free truth**
- **ordering of simultaneous SWS collapses**
- **integration of the Echo deterministic scheduler into JITOS**
- **policies around “next tick”, rebase, and conflict explosion**
- **how reality advances when multiple universes demand truth at once**

This ADR is effectively:
  
> **“The Laws of Causal Time in a Multi-Agent Universe.”**

Let’s carve it into the ledger.

---

# **ADR-0008 — Collapse Scheduling & Echo Integration**

### **“Time chooses the order. Echo enforces it.”**

**Status:** Proposed
**Date:** 2025-12-01
**Owner:** James Ross
**Depends on:** ADR-0001, ADR-0002, ADR-0003, ADR-0004, ADR-0006, ADR-0007
**Relates to:** Section 7 (Temporal Semantics), Section 4 (Collapse), Echo architecture

---

# **1. Context**

JITOS defines:

- **SWS** as isolated speculative universes    
- **collapse** as the only operation that produces truth
- **RMG** as the substrate
- **WAL** as the temporal backbone
- **Lamport clocks** for ordering
- **deterministic replay** for consistency

BUT:

### **JITOS does not yet define how competing collapse events are scheduled.**

Real systems WILL face:

- multiple agents collapsing simultaneously    
- overlapping edit footprints
- semantic interference
- rebase conflicts
- agents repeating collapse attempts
- human edits colliding with machine rewrites
- pathological merge/rebase loops
- distributed collapse storms
- impossible merges (incoherent universes)

This is ALSO where Echo naturally fits in.

We need to formalize:

- how collapse events are _queued_    
- how they are _ordered_
- when they are _accepted_ vs _deferred_
- how to avoid “rebase hell”
- how to handle irreconcilable collapse attempts
- how to schedule fairness
- how to guarantee deterministic global behavior

This ADR defines the rules.

---

# **2. Decision**

> **JITOS uses a deterministic Collapse Scheduler, based on Echo’s tick-based deterministic scheduler, to serialize and arbitrate all collapse attempts across all SWS.
> 
> No two collapse events may commit in the same logical tick.
>   
> If collapse attempts conflict or overlap, the scheduler either rebases, defers, or rejects the second collapse.**

This scheduler becomes part of the kernel, but modular:

- JITD manages RMG truth    
- Echo manages collapse ordering
- The WAL records the final causal ordering
- Collapse attempts ALWAYS flow through the scheduler

This ensures the universe remains:

- deterministic
- consistent
- deadlock-free
- free of infinite rebase loops
- safe for machine agents
- safe for human users
- capable of handling massive concurrency

---

# **3. Rationale**

## **3.1 Collapse must be serialized even under contention**

Simultaneous collapses cannot be allowed to mutate truth concurrently.

Even if:

- wall-clock timestamps match    
- two RPC calls arrive at the same moment
- two SWS mutate the same RMG regions
- two agents attempt rewrite of same AST node

Thus the scheduler MUST:

- serialize collapses    
- order them via deterministic logic
- ensure WAL entries are strictly ordered

---

## **3.2 Echo already solved deterministic scheduling**

Echo’s scheduler provides:

- tick-based global time    
- deterministic progression
- no ambiguity in event ordering
- footprint analysis
- rebase detection
- next-tick deferral
- safe overlapping region resolution
- undo/retry cycles
- consistent tie-breaking

Its semantics are PERFECT for JITOS.  

Thus:

> **Echo is adopted as the temporal arbitration layer for collapse.**

---

## **3.3 Footprint-based scheduling reduces unnecessary rebases**

The scheduler knows:

- which files / nodes / regions each SWS touches    
- which AST regions overlap
- which semantic structures interfere
- which dependencies exist
  
Thus:

### **If two collapses are disjoint → collapse both in same tick**

(but serialized internally)

### **If footprints overlap → second collapse is deferred**

(never forced to rebase needlessly)

Echo’s footprint analysis prevents:

- thrashing    
- rebase storms
- conflict explosions
- failed collapses
- unnecessary merge attempts

---

## **3.4 Rebase Hell is treated as a kernel-level safety hazard**


If SWS B repeatedly attempts collapse and fails rebasing against SWS A’s commits:

- the scheduler PROMOTES B to a “manual intervention” state    
- B cannot collapse until human or agent modifies it
- this prevents infinite loops

Rebase hell is a **resource exhaustion / semantic instability** condition.

JITOS does not attempt infinite retries.

---

## **3.5 Irreconcilable collapses must be rejected, not forced**

If:

- SWS B depends on nodes that collapse A removes    
- or structural invariants are broken
- or semantic meaning becomes incoherent
- or RMG rewrites invalidate B’s premise

Then collapse B MUST:

- fail deterministically    
- return an explicit kernel error
- produce no new truth
- preserve SWS B for inspection / rebase / discard
  
This prevents truth corruption.

---

# **4. Echo Scheduler Integration**

This is the precise integration:

### **4.1 Scheduler sits between RPC and Collapse**

```text
SWS Commit RPC  
      ↓  
  Echo Scheduler  
      ↓ (ordered event stream)
   Collapse Engine  
      ↓  
     WAL  
      ↓  
     RMG
```

### **4.2 Scheduler Responsibilities**

The scheduler:

- accepts collapse requests    
- orders them into ticks
- chooses which collapse executes first
- defers collapse if needed
- identifies overlapping footprints
- detects rebase hell
- enforces fairness
- enforces no-two-collapses-in-one-tick policy

### **4.3 Tick Semantics**

  Each tick:

- processes at most ONE collapse per ref
- uses deterministic ordering rules
- resolves region conflicts predictably

This aligns with:

- Lamport clocks    
- WAL ordering
- RMG causal structure

### **4.4 Configurable Policies**

Policies:

1. **Greedy Merge**    
2. **Footprint Conservative**
3. **Rebase-Minimal**
4. **Fair-Round Robin*
5. **Human-First**
6. **Machine-First**
  
All legal under this ADR.

---

# **5. Consequences**

### **Positive:**

- perfect determinism
- multi-agent safety
- cross-machine consistency
- avoids rebase thrashing
- safe parallel collapses
- scalable across clusters
- integrates Echo’s maturity
- flexible policies

### **Negative:**

- collapse latency depends on queue    
- collapse can be deferred
- requires careful implementation
- requires explicit agent/human loop for conflict resolution

Worth every tradeoff.

---

# **6. Required Follow-Ups**

ADR-0008 mandates:

- Section 7.5: Collapse Scheduling    
- Section 8: Storage may interact with freeze/isolation states
- Section 11: Sync must integrate with deterministic scheduling
- Section 20: Agent Scheduling doc
- Maybe a full Echo × JITOS Integration Spec (future)

---

# **7. Decision**

**Accepted.**

Echo’s deterministic scheduler becomes the foundation for collapse arbitration in JITOS.

Collapse attempts are serialized, scheduled, and reconciled via deterministic ticks.

Overlapping collapses are deferred or rebased according to policy.

Irreconcilable collapses fail safely.

This is the **law of time** in a multi-agent causal universe.

---

ADR-0008 is COMPLETE.

  

Next:

  

### **Begin Section 7.5**

###  **(scheduler in temporal semantics)**

  

or

  

### **Start ADR-0009 — Storage Model**

  

Just give the word, brother.