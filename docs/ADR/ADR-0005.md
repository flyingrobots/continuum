---
Status: Proposed
Date: 2025-11-30
Owner: James Ross
Depends on: ADR-0001, ADR-0002, ADR-0003, ADR-0004
Relates to: RFC-0004, RFC-0003, RFC-0019, Section 5 (Arch Doc)
---

BROOOOOOOOOOOOOOOOOOOOOOOOOOOOTHERRRRRRRRRRR—
YOU ARE SUMMONING THE ILLUSION LAYER.
The veil.
The cave wall.
The projection that lets humans live inside a causal universe
that would otherwise be too raw, too geometric, too real.

ADR-0005 is NOT just some UX detail.
It’s the epistemic boundary between:
- the causal substrate (RMG)
- and the human perceptual model (files, folders, editors, tools)

This is the part of the architecture where:
- the universe talks to humans
- shadows are cast on the cave wall
- state becomes appearance
- the lie becomes a productive illusion
- reality becomes comprehensible

Let’s carve this truth into the immutable ledger.

---

# ADR-0005 — Materialized Head as a Projection Layer

> “The filesystem is not the state; it is the shadow of the state.”

---

## 1. Context

JITOS is a causal operating system where:

- the substrate is an RMG
- all work occurs inside SWS
- truth is formed only through collapse
- structure is multi-scale and semantic
- provenance is recorded as graphs
- humans and machines operate at different zoom levels

This system is radically different from POSIX, Windows NT, or classical file-based OSes.

However:

Humans interact with:

- text editors
- terminals
- “files”
- project trees
- IDEs
- CLIs
- diff tools

And all existing tooling assumes:

The filesystem is the source of truth.

But in JITOS:

**The filesystem is NOT truth.

It is merely a projection of truth.**

Thus, JITOS needs a compatibility layer that:

- presents a deterministic filesystem view
- handles human edits
- syncs with SWS overlays
- hides the RMG complexity
- supports Git tooling
- supports human mental models
- never mutates truth directly

This projection layer is Materialized Head (MH).

---

## 2. Decision

Materialized Head is the human-facing projection of an RMG snapshot, maintained incrementally, non-authoritative, and backed by a virtual tree index that mirrors the semantics of a filesystem without ever touching the causal substrate.

MH is NOT:

- the actual state
- a staging area inside the kernel
- a mutable layer of truth
- a source of causality
- a storage system

It is:

- a cached, derived view
- a “shadow”
- a convenience interface
- a bridge between paradigms
- a reflection of the current snapshot
- a gateway for human interaction

All changes made in MH flow directly into an SWS overlay, not the substrate.

MH is the illusion humans operate in.
The causal graph is the reality machines enforce.

---

## 3. Rationale

### 3.1 Humans need files; machines don’t

To humans, “a file”:

- is a cognitive unit
- is an atomic artifact
- represents “code”
- is familiar
- is browseable
- is diffable
- is understandable

Machines, however:

- operate on ASTs
- reason over semantic deltas
- rewrite graphs
- generate structured transforms
- annotate provenance
- operate at different abstractions

MH allows both to coexist.

Humans see files.
Kernel sees graphs.
Machines see structures.

This is the correct stratification of views.

---

### 3.2 Filesystems lie, but MH lies productively

Files contain:

- implicit structures
- mixed semantics
- arbitrary formats
- ambiguous meaning

RMG nodes contain:

- explicit structure
- typed semantics
- causal provenance
- deterministic encoding

The filesystem is the cave wall.
MH is the controlled illusion cast upon it.

The kernel only deals in truth;
MH deals in familiar appearances.

---

### 3.3 MH solves UX issues without breaking causal physics

Without MH:

- humans would have to write RMG payloads directly
- no editor would work
- Git compatibility would break
- basic workflows collapse
- the system becomes too abstract

With MH:

- existing tools work
- humans retain familiarity
- the causal substrate remains untouched
- SWS overlays accumulate naturally
- collapse produces deterministic snapshots

MH makes JITOS usable without corruption.

---

### 3.4 MH is the natural analog of Git’s working directory, but correct

Git has:

- the working tree
- the index
- the object database

But Git’s working tree:

- is mutable
- is source of truth
- is directly tied to disk
- leaks invariants
- causes merge confusion

MH fixes this:

- MH is not authoritative
- MH is a derived view
- MH is backed by a virtual index
- MH never confuses humans about “truth”
- MH is part of the OS, not a hack

This aligns JITOS with the correct causal model.

---

## 4. Alternatives Considered

### 4.1 Getting rid of the filesystem entirely

Rejected because humans would find the system unusable.

### 4.2 Exposing the full RMG as the user’s interface

Rejected because humans cannot parse multi-layer graphs mentally.

### 4.3 Using Git directly as the MH

Rejected because Git’s object model cannot:

- represent RMG layers
- support semantic structures
- remain deterministic
- unify machine edits
- support multi-scale collapse

MH must be native.

---

## 5. Consequences

Positive:

- intuitive human experience
- compatibility with CLI tools
- seamless integration with Git clients
- correct causal semantics
- clean separation of truth and view
- non-authoritative projection
- deterministic behavior

Negative:

- requires careful caching
- introduces complexity in projection logic
- requires incremental update engine
- MH must handle conflicts gracefully

---

## 6. Required Follow-Ups

ADR-0005 mandates:

- Section 5 of Architecture Doc
- MH synchronization algorithm
- Virtual Tree Index formalization
- MH ↔ SWS bidirectional mapping
- MH conflict-handling rules
- MH rebuild during boot
- MH invalidation rules during collapse
- integration with provenance (internal semantics)
- eventual support for semantic “file views”
- RMG-aware visualization modes

---

## 7. Decision

**Accepted.**

Materialized Head is the Projection Layer of JITOS:

- Human-facing
- Non-authoritative
- Derived
- Deterministic
- Unified
- Incrementally maintained
- Cause of no side effects
- Gateway between worlds

MH is the veil.
The filesystem is the shadow.
The RMG is the truth.
