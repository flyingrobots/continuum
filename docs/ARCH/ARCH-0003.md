# JITOS Architecture Document — Section 3

## The Substrate Model: Recursive Meta-Graph (RMG)

(Grounded in [ADR-0003](../ADR/ADR-0003.md))

---

# 1. The Substrate Model: Recursive Meta-Graph (RMG)

### 1.1 Overview

Every operating system requires a substrate—the foundational structure that represents state, organizes memory, and defines the rules of mutation.

Traditional OSes use:

- disk blocks
- inodes
- mutable files
- byte-addressable memory
- process heaps
- pointer graphs

These forms assume:

- a linear sense of time
- mutable memory cells
- arbitrary writes
- no integrated notion of causality or provenance
- a flat or shallow data structure

JITOS rejects all of it.

Instead, the JITOS substrate is a Recursive Meta-Graph (RMG):

> A hierarchical, multi-scale graph where nodes, edges, node types, schemas, and even rewrite rules are themselves represented as graphs.

The RMG is the foundation of:

- causal history
- semantic structure
- multi-scale edits
- provenance
- SWS overlays
- AST graphs
- federation
- identity
- schema evolution
- rewrite semantics

A causal DAG appears as a projection inside the RMG—the first-order timeline of event nodes.

Reality is the RMG.
Time is the DAG.

---

### 1.2 Why the substrate cannot be “just a DAG”

Earlier thinking (and the Git lineage) treated “state as a DAG of commits.”

JITOS requires more:

1. Nodes contain structure

Not bytes, not blobs—
but graphs:

- ASTs
- semantic deltas
- provenance subgraphs
- rewrite metadata
- overlay chains
- file chunk graphs

2. Provenance requires a meta-layer

Provenance nodes reference other nodes as semantic relationships:

- why something changed
- how it changed
- tool reasoning
- experiment metadata
- agent thought processes

This is a graph-of-graphs.

3. Multi-scale edits require nested structure

Human-level “one commit”
= a micro-universe of internal machine-level events.

4. Federation requires cross-universe linking

Not merging DAGs—
linking RMGs.

5. Schema evolution needs a meta-graph

The node type system itself must be representable and rewritable.

6. Rewrite rules operate across layers

Inversion rewrite nodes touch not just content, but graph structure.

A mere DAG CANNOT:

- represent deep semantic changes
- express nested structure
- handle multi-universe federation
- carry meta-graphs or schema graphs
- unify granular & macro events
- support CΩMPUTER theory

Thus:

> JITOS’s truth-layer is an RMG.

---

### 1.3 RMG Definition (Formal)

The substrate graph G is defined as:

- A set of nodes, each containing:
  - a payload graph
  - a type-graph reference
  - metadata
  - signatures
  - logical timestamp
- A set of edges:
  - causal edges
  - structural edges
  - semantic edges
  - provenance edges
  - federation edges
- A recursive schema:
  - Node types defined as meta-graphs
  - Rewrite rules expressed as graph transformations
  - Valid states defined by invariant meta-graphs
- Projection functions:
  - $$DAG(G)$$ → first-order causal timeline
  - $$MH(G)$$ → human file projection
  - $$AST(G)$$ → code-level structure
  - $$Semantic(G)$$ → agent reasoning graphs

This allows:

- arbitrary levels of nesting
- recursion
- infinite depth
- uniform rewrite rules
- multi-scale representation

The RMG is the total state-space of JITOS.

The causal DAG is a lens.

---

### 1.4 The Causal DAG (First-Order Projection)

While the RMG holds all information,
a subset forms the Causal DAG:

- snapshot nodes
- inversion-rewrite nodes
- provenance nodes
- file-chunk nodes
- SWS collapse events
- timestamped commits

Properties:

- append-only
- no mutation
- no deletion
- no cycles
- deterministic
- linearly extensible per branch

The DAG is:

- human-scale
- time-oriented
- used for ref movement
- used for sync frontiers
- the “observable spacetime”
- analogous to spacetime slices in physics

But the DAG is not the universe.
Just the part of the universe humans see.

---

### 1.5 RMG Layers (Multi-Level Reality)

The RMG organizes data into layered semantic spaces:

#### Layer 0 — Causal Layer (DAG)

The timeline of events.

#### Layer 1 — Structural Layer

Graphs representing internal structure of events:

- file chunks
- ASTs
- provenance content
- rewrite detail

#### Layer 2 — Semantic Layer

Graphs representing meaning:

- agent reasoning
- semantic deltas
- patterns
- interpretations

#### Layer 3 — Meta Layer

Schemas, rewrite rules, invariants, federation descriptors.

#### Layer 4 — Meta-Meta Layer

(Advanced)
Formal properties, abstractions, ontology definitions.

This corresponds beautifully to:

- CΩMPUTER Vol I (geometry)
- CΩMPUTER Vol II (meta-geometry)
- CΩMPUTER Vol III (meta-meta geometry)

---

3.6 RMG Evolution & Rewriting

Rewrite operations occur at multiple scales:
- SWS collapse rewrites at DAG layer
- inversion rewrites at structural layer
- AST rewrites at semantic layer
- provenance rewrites at meaning layer
- schema evolution rewrites at meta-layer

This is managed by:
- Inversion Engine
- Future DPO / graph rewrite engine
- Provenance interpreter
- Agent-level semantic transformers

JITOS is the first system to integrate all of these natively.

---

3.7 RMG & Federation

Universes are not DAGs.
Universes are RMGs.

Federation edges link RMG → RMG:
- dependency edges
- semantic references
- provenance imports
- foreign node graphs
- remote schemas

Sync becomes:
- subgraph negotiation
- meta-graph validation
- cross-universe topological alignment

This is not possible in a DAG-only model.

---

3.8 RMG Summary

The Recursive Meta-Graph substrate provides:

| Property                  | DAG        | RMG      |
| ------------------------- | ---------- | -------- |
| Causal timeline           | ✔          | ✔        |
| Semantic structure        | ✘          | ✔        |
| Graph-of-graphs           | ✘          | ✔        |
| Nested events             | ✘          | ✔        |
| Semantic provenance       | weak       | strong   |
| Schema evolution          | awkward    | natural  |
| Agent reasoning           | none       | native   |
| Multi-universe federation | hacky      | elegant  |
| Multi-scale edits         | impossible | inherent |
| CΩMPUTER alignment        | partial    | perfect  |

Thus:

> The DAG is the visible universe.
> The RMG is the actual universe.

---

## 1.9 Closing Summary

JITOS runs not on a file system,
not on a mutable memory model,
not on a commit DAG,

but on a Recursive Meta-Graph:

- immutable
- hierarchical
- semantic
- meta-aware
- multi-scaled
- agent-native
- universal
- and causally structured

The RMG is the substrate of truth,
and the DAG is its shadow.

This completes the foundation for:

- [ADR-0004](../ADR/ADR-0004.md) (RMG scale invariance)
- [Section 4](./0004.md) (Collapse & Inversion Engine)
- [Section 6](./0006.ms) (Memory Model)
- Semantic Provenance
- Federation
- CΩMPUTER fusion
